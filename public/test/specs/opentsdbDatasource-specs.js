/*! grafana - v2.6.0 - 2015-12-14
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache-2.0 */

define(["./helpers","app/plugins/datasource/opentsdb/datasource"],function(a){"use strict";describe("opentsdb",function(){var b=new a.ServiceTestContext;beforeEach(module("grafana.core")),beforeEach(module("grafana.services")),beforeEach(b.providePhase(["backendSrv"])),beforeEach(b.createService("OpenTSDBDatasource")),beforeEach(function(){b.ds=new b.service({url:[""]})}),describe("When performing metricFindQuery",function(){var a,c;beforeEach(function(){b.backendSrv.datasourceRequest=function(a){return c=a,b.$q.when({data:[{target:"prod1.count",datapoints:[[10,1],[12,1]]}]})}}),it("metrics() should generate api suggest query",function(){b.ds.metricFindQuery("metrics(pew)").then(function(b){a=b}),b.$rootScope.$apply(),expect(c.url).to.be("/api/suggest"),expect(c.params.type).to.be("metrics"),expect(c.params.q).to.be("pew")}),it("tag_names(cpu) should generate looku  query",function(){b.ds.metricFindQuery("tag_names(cpu)").then(function(b){a=b}),b.$rootScope.$apply(),expect(c.url).to.be("/api/search/lookup"),expect(c.params.m).to.be("cpu")}),it("tag_values(cpu, test) should generate looku  query",function(){b.ds.metricFindQuery("tag_values(cpu, hostname)").then(function(b){a=b}),b.$rootScope.$apply(),expect(c.url).to.be("/api/search/lookup"),expect(c.params.m).to.be("cpu{hostname=*}")}),it("suggest_tagk() should generate api suggest query",function(){b.ds.metricFindQuery("suggest_tagk(foo)").then(function(b){a=b}),b.$rootScope.$apply(),expect(c.url).to.be("/api/suggest"),expect(c.params.type).to.be("tagk"),expect(c.params.q).to.be("foo")}),it("suggest_tagv() should generate api suggest query",function(){b.ds.metricFindQuery("suggest_tagv(bar)").then(function(b){a=b}),b.$rootScope.$apply(),expect(c.url).to.be("/api/suggest"),expect(c.params.type).to.be("tagv"),expect(c.params.q).to.be("bar")})})})});